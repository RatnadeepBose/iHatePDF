<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Merge PDF - iHatePDF</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
    body {
        background: #F7F7F7;
        font-family: 'Inter', sans-serif;
    }
    .drag {
        background: #FFF1F3;
        border-color: #E11D48;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .fade-in {
        animation: fadeIn 0.3s ease-in-out;
    }
    .file-item {
        transition: all 0.2s ease;
    }
    .file-item:hover {
        transform: translateX(2px);
    }
</style>
</head>

<body class="flex flex-col min-h-screen">

<!-- NAV -->
<nav class="bg-white px-4 sm:px-6 py-3 shadow-sm flex justify-between items-center sticky top-0 z-50">
    <a href="index.html" class="flex items-center">
        <img src="image.png" class="h-7 sm:h-8">
    </a>
    <span class="text-red-600 font-bold text-sm sm:text-base">Merge PDF</span>
</nav>


<!-- MAIN -->
<div class="flex-grow flex items-center justify-center px-4 py-8 sm:py-12">
    <div class="w-full max-w-md sm:max-w-lg mx-auto text-center">

        <!-- HEADER -->
        <div class="mb-6 sm:mb-8 fade-in">
            <div class="w-14 h-14 sm:w-16 sm:h-16 bg-red-100 text-red-600 rounded-xl flex items-center justify-center mx-auto mb-3 sm:mb-4">
                <i class="fa-solid fa-object-group text-xl sm:text-2xl"></i>
            </div>
            <h1 class="text-xl sm:text-2xl font-bold text-gray-900 mb-2">Merge PDF</h1>
            <p class="text-gray-600 text-xs sm:text-sm">Upload files → Merge → Download instantly</p>
        </div>


        <!-- DROPBOX -->
        <div id="drop" class="border-2 border-dashed border-gray-300 rounded-lg bg-white p-6 sm:p-8 cursor-pointer hover:border-red-400 transition-all duration-200">
            <input type="file" id="input" accept="application/pdf" multiple class="hidden">
            <i class="fa-solid fa-cloud-arrow-up text-3xl sm:text-4xl text-red-500 mb-2"></i>
            <p class="text-sm sm:text-base font-medium text-gray-700">Click or Drop your PDF files</p>
            <p class="text-xs text-gray-500 mt-1">Multiple files allowed • Max 50MB each</p>
        </div>

        
        <!-- FILES LIST -->
        <div id="list" class="mt-4 sm:mt-5 space-y-2 max-h-60 overflow-y-auto"></div>

        <!-- FILE COUNT -->
        <div id="file-count" class="hidden mt-3 text-xs sm:text-sm text-gray-600 fade-in">
            <span id="count">0</span> files selected
        </div>

        <!-- MERGE BUTTON -->
        <button id="merge" class="hidden mt-4 sm:mt-6 bg-red-600 hover:bg-red-700 text-white px-6 py-2 sm:px-8 sm:py-3 rounded-lg text-sm sm:text-base font-bold shadow-md hover:shadow-xl transition-all duration-200 w-full max-w-xs fade-in disabled:opacity-50 disabled:cursor-not-allowed">
            <i class="fa-solid fa-object-group mr-2"></i>Merge PDFs
        </button>

        <!-- LOADING SPINNER -->
        <div id="loading" class="hidden mt-4 sm:mt-5 fade-in">
            <div class="flex items-center justify-center space-x-2 text-red-600">
                <i class="fa-solid fa-spinner fa-spin text-lg"></i>
                <span class="text-sm font-medium">Merging PDF files...</span>
            </div>
            <p class="text-xs text-gray-500 mt-2" id="progress-text">Processing files</p>
        </div>

        <!-- DOWNLOAD SECTION -->
        <div id="done" class="hidden mt-4 sm:mt-6 fade-in">
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                <i class="fa-solid fa-check-circle text-green-600 text-lg mr-2"></i>
                <span class="text-green-800 text-sm font-medium">PDFs merged successfully!</span>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-3 justify-center items-center">
                <!-- START OVER BUTTON -->
                <button id="start-over" 
                        class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 sm:px-8 sm:py-3 rounded-lg text-sm sm:text-base font-bold inline-flex items-center justify-center transition-colors duration-200 w-full sm:w-auto">
                    <i class="fa-solid fa-rotate-left mr-2"></i>Start Over
                </button>
                
                <!-- DOWNLOAD BUTTON -->
                <a id="download" download="merged.pdf"
                   class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 sm:px-8 sm:py-3 rounded-lg text-sm sm:text-base font-bold shadow-lg hover:shadow-xl inline-flex items-center justify-center transition-colors duration-200 w-full sm:w-auto">
                   <i class="fa-solid fa-download mr-2"></i>Download File
                </a>
            </div>
        </div>

        <!-- ERROR MESSAGE -->
        <div id="error-message" class="hidden mt-4 p-3 bg-red-50 border border-red-200 rounded-lg fade-in">
            <i class="fa-solid fa-exclamation-triangle text-red-600 mr-2"></i>
            <span id="error-text" class="text-red-800 text-sm"></span>
        </div>

    </div>
</div>

<!-- FOOTER -->
<footer class="bg-white border-t border-gray-200 py-4 mt-auto">
    <div class="text-center text-gray-600 text-xs sm:text-sm">
        © 2025 iHatePDF - Your PDF Editor
    </div>
</footer>

<!-- SCRIPT -->
<script>
let files = [];

const drop = document.getElementById("drop");
const input = document.getElementById("input");
const list = document.getElementById("list");
const merge = document.getElementById("merge");
const done = document.getElementById("done");
const download = document.getElementById("download");
const startOverBtn = document.getElementById("start-over");
const loading = document.getElementById("loading");
const errorMessage = document.getElementById("error-message");
const errorText = document.getElementById("error-text");
const fileCount = document.getElementById("file-count");
const countSpan = document.getElementById("count");
const progressText = document.getElementById("progress-text");

// Click to open file chooser
drop.onclick = () => input.click();

// Drag and drop handlers
drop.ondragover = (e) => { 
    e.preventDefault(); 
    drop.classList.add("drag"); 
};

drop.ondragleave = () => { 
    drop.classList.remove("drag"); 
};

drop.ondrop = (e) => { 
    e.preventDefault(); 
    drop.classList.remove("drag"); 
    add(e.dataTransfer.files); 
};

// File input change
input.onchange = e => add(e.target.files);

// Show error message
function showError(message) {
    errorText.textContent = message;
    errorMessage.classList.remove("hidden");
    setTimeout(() => {
        errorMessage.classList.add("hidden");
    }, 5000);
}

// Hide error message
function hideError() {
    errorMessage.classList.add("hidden");
}

// Add files with validation
function add(newFiles) {
    hideError();
    
    for (let file of newFiles) {
        // Check file type
        if (file.type !== "application/pdf") {
            showError("Only PDF files are allowed");
            continue;
        }

        // Check file size (50MB limit)
        if (file.size > 50 * 1024 * 1024) {
            showError(`File "${file.name}" is too large (max 50MB)`);
            continue;
        }

        // Check for duplicates
        if (files.some(f => f.name === file.name && f.size === file.size)) {
            showError(`File "${file.name}" is already added`);
            continue;
        }

        files.push(file);
    }
    
    render();
}

// Render file list
function render() {
    list.innerHTML = "";
    
    if (files.length === 0) {
        fileCount.classList.add("hidden");
        merge.classList.add("hidden");
        return;
    }

    files.forEach((file, index) => {
        const fileSize = (file.size / (1024 * 1024)).toFixed(2);
        const fileItem = document.createElement("div");
        fileItem.className = "file-item p-3 bg-white rounded-lg border border-gray-200 flex justify-between items-center shadow-sm text-sm fade-in";
        fileItem.draggable = true;
        fileItem.dataset.index = index;
        
        fileItem.innerHTML = `
            <div class="flex items-center space-x-3 flex-1 min-w-0">
                <div class="w-8 h-8 bg-red-100 text-red-600 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-file-pdf text-xs"></i>
                </div>
                <div class="flex-1 min-w-0 text-left">
                    <p class="font-medium text-gray-900 text-xs sm:text-sm truncate">${file.name}</p>
                    <p class="text-gray-500 text-xs">${fileSize} MB</p>
                </div>
            </div>
            <div class="flex items-center space-x-2 ml-3">
                <span class="text-xs text-gray-400 font-mono bg-gray-100 px-2 py-1 rounded">${index + 1}</span>
                <button onclick="removeFile(${index})" class="text-red-500 hover:text-red-700 transition-colors p-1 rounded">
                    <i class="fa-solid fa-xmark text-sm"></i>
                </button>
            </div>
        `;

        // Drag and drop for reordering
        fileItem.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', index);
            fileItem.classList.add('opacity-50');
        });

        fileItem.addEventListener('dragend', () => {
            fileItem.classList.remove('opacity-50');
        });

        fileItem.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        fileItem.addEventListener('drop', (e) => {
            e.preventDefault();
            const fromIndex = parseInt(e.dataTransfer.getData('text/plain'));
            const toIndex = index;
            reorderFiles(fromIndex, toIndex);
        });

        list.appendChild(fileItem);
    });

    // Update file count
    countSpan.textContent = files.length;
    fileCount.classList.remove("hidden");
    
    // Show/hide merge button
    merge.classList.toggle("hidden", files.length < 2);
    
    // Hide download section when files change
    done.classList.add("hidden");
    loading.classList.add("hidden");
}

// Remove file
function removeFile(index) {
    files.splice(index, 1);
    render();
}

// Reorder files
function reorderFiles(fromIndex, toIndex) {
    if (fromIndex === toIndex) return;
    
    const [movedFile] = files.splice(fromIndex, 1);
    files.splice(toIndex, 0, movedFile);
    render();
}

// Merge PDFs
merge.onclick = async () => {
    if (files.length < 2) {
        showError("Please select at least 2 PDF files to merge");
        return;
    }

    // Show loading state
    merge.classList.add("hidden");
    loading.classList.remove("hidden");
    hideError();

    try {
        const output = await PDFLib.PDFDocument.create();

        for (let i = 0; i < files.length; i++) {
            progressText.textContent = `Processing file ${i + 1} of ${files.length}...`;
            
            const file = files[i];
            const pdfBytes = await file.arrayBuffer();
            const pdf = await PDFLib.PDFDocument.load(pdfBytes);
            const pages = await output.copyPages(pdf, pdf.getPageIndices());
            pages.forEach(p => output.addPage(p));
        }

        const data = await output.save();
        const blob = new Blob([data], { type: "application/pdf" });
        download.href = URL.createObjectURL(blob);
        
        // Show success section
        done.classList.remove("hidden");
        
    } catch (error) {
        console.error("Error merging PDFs:", error);
        showError("Error merging PDFs. Please try again with different files.");
    } finally {
        loading.classList.add("hidden");
        merge.classList.remove("hidden");
    }
};

// Start Over button functionality
startOverBtn.onclick = () => {
    // Reset files array
    files = [];
    
    // Reset file input
    input.value = '';
    
    // Hide elements
    merge.classList.add("hidden");
    done.classList.add("hidden");
    loading.classList.add("hidden");
    fileCount.classList.add("hidden");
    errorMessage.classList.add("hidden");
    
    // Clear file list
    list.innerHTML = '';
    
    /// Revoke previous blob URL to free memory
    if (download.href && download.href.startsWith('blob:')) {
        URL.revokeObjectURL(download.href);
    }
    
    // Reset drop zone appearance
    drop.classList.remove("drag");
};

// Add keyboard support
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        startOverBtn.click();
    }
});
</script>

</body>
</html>